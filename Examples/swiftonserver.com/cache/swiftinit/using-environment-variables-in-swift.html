<section class='introduction'><h1>Using environment variables in Swift</h1></section><section class='details literature'><p>Environment variables are key-value pairs that can be used to alter the behavior of an application. The variables are part of the environment in which a process runs. The environment is injected during the runtime of the application. Environment variables can be set at the system level or they can be defined by the end-user.</p><p>Environment variables are commonly used for configuration purposes. It is possible to set different configuration values for development, testing and production environment. It is possible to use env vars as feature flags or to specify secrets and keys and keep them separate from the application codebase.</p><p>For example, an app could take advantage of the <code>LOG_LEVEL=trace</code> environment variable to set the log level using the Logging library (<a href='../logging-for-server-side-swift-apps'>Logging for server-side Swift apps</a>) in Swift. By using an env variable developers can get more detailed logs for debugging purposes and less verbose logs for production without changing the source code of the application itself.</p><h2 id='How%20to%20access%20environment%20variables%20in%20Swift?'><a href='#How%20to%20access%20environment%20variables%20in%20Swift?'>How to access environment variables in Swift?</a></h2><p>In Swift, it is possible to access environment variables using the <a href='https://swiftinit.org/docs/swift/foundation/processinfo' target='_blank' rel='external'>ProcessInfo</a> class. The <em>ProcessInfo</em> class is part of the Foundation framework.</p><p>Here’s a quick example how to get the value of the <code>LOG_LEVEL</code> variable:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>import</span> <span class='xv'>Foundation</span><span class='newline'>

</span><span class='xk'>let</span> <span class='xv'>env</span> = <a class='xt' href='https://swiftinit.org/docs/swift/foundation/processinfo' target='_blank' rel='external'>ProcessInfo</a>.<a class='xv' href='https://swiftinit.org/docs/swift/foundation/processinfo.processinfo' target='_blank' rel='external'>processInfo</a>.<a class='xv' href='https://swiftinit.org/docs/swift/foundation/processinfo.environment' target='_blank' rel='external'>environment</a><span class='newline'>

</span><span class='xk'>let</span> <span class='xv'>value</span> = <span class='xv'>env</span><a href='https://swiftinit.org/docs/swift/swift/dictionary.subscript(_:)?hash=8RFQL' target='_blank' rel='external'>[</a><span class='xs'>"LOG_LEVEL"</span>] <a class='xv' href='https://swiftinit.org/docs/swift/swift.%3F%3F(_:_:)?hash=8BUAU' target='_blank' rel='external'>??</a> <span class='xs'>"trace"</span><span class='newline'>

</span><a class='xv' href='https://swiftinit.org/docs/swift/swift.print(_:separator:terminator:)' target='_blank' rel='external'>print</a>(<span class='xv'>value</span>)</code></pre><a rel='ugc' href='https://github.com/swift-on-server/site/blob/main/Snippets/environment.swift' target='_blank' class='source github'><span class='file'>environment.swift</span></a><p>The process info’s environment is represented a <code>[String: String]</code> dictionary. When requesting a specific key, the value is going to be an optional <code>String</code> type.</p><p>The output of this script is <em>trace</em>, if the <code>LOG_LEVEL</code> is not provided explicitly.</p><h2 id='How%20to%20set%20environment%20variables?'><a href='#How%20to%20set%20environment%20variables?'>How to set environment variables?</a></h2><p>There are several methods for configuring environment variables, and the approach you take depends on the specific tools you’re working with.</p><p>Here are some typical scenarios for setting up custom environment variables.</p><h3 id='Setting%20env%20vars%20using%20the%20command%20line'><a href='#Setting%20env%20vars%20using%20the%20command%20line'>Setting env vars using the command line</a></h3><p>List the desired environment variables before the command when running a Swift package using a terminal window. Key-value pairs should be listed using the <code>key=value</code> format, separated by a single space character.</p><p>Here’s how to define an explicit log level by using the <code>swift run</code> command:</p><pre class='snippet'><code class='language-sh'><span class='newline'></span>LOG_LEVEL=debug swift run<span class='newline'>

</span>// output: "debug"</code></pre><p>The command above makes the <code>LOG_LEVEL</code> env variable set to <code>trace</code> for the <code>swift run</code> process. Traditionally environment variables are uppercased.</p><p>The export command extends the availability of an environment variable throughout the shell’s entire lifecycle. Here’s how to use it:</p><pre class='snippet'><code class='language-sh'><span class='newline'></span>echo $LOG_LEVEL // output: ""<span class='newline'>

</span>export LOG_LEVEL=info <span class='newline'>

</span>echo $LOG_LEVEL // output: "info"<span class='newline'>

</span>swift run<span class='newline'>

</span>// output: "info"</code></pre><p>The <code>echo</code> command is used to display variables in a shell script. Use the $ prefix and the name of the variable to access the value of it.</p><h3 id='Setting%20env%20vars%20using%20Xcode'><a href='#Setting%20env%20vars%20using%20Xcode'>Setting env vars using Xcode</a></h3><p>In Xcode, you can configure environment variables within the Scheme settings. The interface permits enabling or disabling specific key-value pairs for a particular run.</p><p>Here’s how to reach the settings:</p><ul><li><p>Open the project in Xcode.</p></li><li><p>Select the “Product” &gt; “Scheme” &gt; “Edit Scheme…” menu item.</p></li></ul><p>Alternatively, click on the Scheme name and select the “Edit Scheme…” menu item:</p><p><img alt='Edit Scheme in Xcode' src='https://raw.githubusercontent.com/swift-on-server/site/main/Sources/site/Documentation.docc/2024/using-environment-variables-in-swift/images/edit-scheme-in-xcode.png'></p><p>Inside the popup window:</p><ul><li><p>Select the “Run” option on the sidebar.</p></li><li><p>Select the “Arguments” tab.</p></li></ul><p><img alt='Set env in Xcode' src='https://raw.githubusercontent.com/swift-on-server/site/main/Sources/site/Documentation.docc/2024/using-environment-variables-in-swift/images/set-env-in-xcode.png'></p><p>Finally, add a new entry into the “Environment Variables” section.</p><p>Click “Close” to get back to the project and press the “Play” icon to run the app.</p><h3 id='Setting%20env%20vars%20using%20Visual%20Studio%20Code'><a href='#Setting%20env%20vars%20using%20Visual%20Studio%20Code'>Setting env vars using Visual Studio Code</a></h3><p>It is possible to develop Swift projects with VSCode (see <a href='../developing-with-swift-in-visual-studio-code'>Developing with Swift in Visual Studio Code</a>) using the <a href='https://www.swift.org/blog/vscode-extension/' target='_blank' rel='external'>official Swift extension</a>.</p><p>In order to set environment variables in the editor, open the <code>.vscode/launch.json</code> file in your workspace or select the “Debug” &gt; “Open Configurations” menu item.</p><p>Inside the launch configuration file simply add to a new <code>env</code> property, if it’s not present, with the desired key-value pairs:</p><p><img alt='Set env in VSCode' src='https://raw.githubusercontent.com/swift-on-server/site/main/Sources/site/Documentation.docc/2024/using-environment-variables-in-swift/images/set-env-in-vscode.png'></p><p>Save the launch config and run the project using the “Play” icon inside the “Run and Debug” panel or using the “Run” &gt; “Start Debugging” menu item.</p><h2 id='Using%20dotenv%20files'><a href='#Using%20dotenv%20files'>Using dotenv files</a></h2><p>A <code>.env</code> file is a text file commonly used to store environment variables for a project. It contains key-value pairs in the form of <code>KEY=VALUE</code>, where each line represents a different variable. Developers use libraries or tools to load the variables from the <em>.env</em> file into the application’s environment. This allows the application to access these variables as if they were set directly in the system’s environment.</p><p>NOTE: The <em>.env</em> files should be excluded from git using <em>.gitignore</em>.</p><p>The <em>.env</em> file provides a flexible and convenient way to manage environment-specific configuration settings in a project while keeping sensitive information secure and separate from the codebase.</p><p>Various open-source Swift libraries exist for server-side application developers, providing functionality to parse dotenv files. For instance:</p><ul><li><p><a href='https://github.com/thebarndog/swift-dotenv' target='_blank' rel='external'>thebarndog/swift-dotenv</a></p></li><li><p><a href='https://github.com/swiftpackages/DotEnv' target='_blank' rel='external'>swiftpackages/DotEnv</a></p></li><li><p><a href='https://github.com/clarkgunn/DotEnv/' target='_blank' rel='external'>clarkgunn/DotEnv/</a></p></li></ul><p>Most of the modern web frameworks, have excellent support for loading dotenv files. Both <a href='https://docs.vapor.codes/basics/environment/?h=environ#env-dotenv' target='_blank' rel='external nofollow noopener ugc'>Vapor</a> and <a href='https://hummingbird-project.github.io/hummingbird-docs/1.0/documentation/hummingbirdauth/hbenvironment/dotenv(_:)' target='_blank' rel='external nofollow noopener ugc'>Hummingbird</a> have a built-in solution to load and parse environment variables using these files.</p><h2 id='Using%20the%20environment%20in%20Vapor'><a href='#Using%20the%20environment%20in%20Vapor'>Using the environment in Vapor</a></h2><p>Vapor’s <a href='https://docs.vapor.codes/basics/environment/' target='_blank' rel='external nofollow noopener ugc'>Environment API</a> enables dynamic configuration of the application:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>import</span> <span class='xv'>Vapor</span><span class='newline'>

</span><span class='xc'>// configures your application</span><span class='newline'>
</span><span class='xk'>public</span> <span class='xk'>func</span> <span class='xv'>configure</span>(_ <span class='xv'>app</span>: <span class='xt'>Application</span>) <span class='xk'>async</span> <span class='xk'>throws</span> {<span class='newline'>
</span>    <span class='newline'>
</span>    <span class='xc'>// 1.</span><span class='newline'>
</span>    <span class='xk'>var</span> <span class='xv'>logger</span> = <span class='xv'>Logger</span>(<span class='xv'>label</span>: <span class='xs'>"vapor-logger"</span>)<span class='newline'>
</span>    <span class='xv'>logger</span>.<span class='xv'>logLevel</span> = .<span class='xv'>trace</span><span class='newline'>

</span>    <span class='xc'>// 2.</span><span class='newline'>
</span>    <span class='xk'>let</span> <span class='xv'>logLevel</span> = <span class='xv'>Environment</span>.<span class='xv'>get</span>(<span class='xs'>"LOG_LEVEL"</span>)<span class='newline'>
</span>    <span class='newline'>
</span>    <span class='xc'>// 3.</span><span class='newline'>
</span>    <span class='xk'>if</span> <span class='xk'>let</span> <span class='xv'>logLevel</span>, <span class='xk'>let</span> <span class='xv'>logLevel</span> = <span class='xv'>Logger</span>.<span class='xv'>Level</span>(<span class='xv'>rawValue</span>: <span class='xv'>logLevel</span>) {<span class='newline'>
</span>        <span class='xc'>// 4.</span><span class='newline'>
</span>        <span class='xv'>logger</span>.<span class='xv'>logLevel</span> = <span class='xv'>logLevel</span><span class='newline'>
</span>    }<span class='newline'>
</span>    <span class='newline'>
</span>    <span class='xk'>try</span> <span class='xv'>routes</span>(<span class='xv'>app</span>)<span class='newline'>
</span>}</code></pre><ol><li><p>Set up a new <em>Logger</em> instance, set the default log level to <em>.trace</em></p></li><li><p>Get the the raw log level as an optional String using the Environment</p></li><li><p>Cast the log level to a <code>Logger.Level</code> enum, if it’s a valid input</p></li><li><p>Set the log level based on the environment</p></li></ol><p>Vapor will look for dotenv files in the current working directory. If you’re using Xcode, make sure to set the working directory by editing the scheme.</p><h2 id='Using%20the%20environment%20in%20Hummingbird%202'><a href='#Using%20the%20environment%20in%20Hummingbird%202'>Using the environment in Hummingbird 2</a></h2><p>In Hummingbird, it is possible to use the shared environment or load dotenv files using the static <code>dotEnv()</code> method on the  <a href='https://hummingbird-project.github.io/hummingbird-docs/1.0/documentation/hummingbirdauth/hbenvironment' target='_blank' rel='external nofollow noopener ugc'>HBEnvironment</a> struct:</p><pre class='snippet'><code class='language-swift'><span class='newline'></span><span class='xk'>import</span> <span class='xv'>Hummingbird</span><span class='newline'>
</span><span class='xk'>import</span> <span class='xv'>Logging</span><span class='newline'>

</span><span class='xk'>func</span> <span class='xv'>buildApplication</span>(<span class='newline'>
</span>    <span class='xv'>configuration</span>: <span class='xt'>ApplicationConfiguration</span><span class='newline'>
</span>) <span class='xk'>async</span> <span class='xk'>throws</span> -&gt; <span class='xk'>some</span> <span class='xt'>ApplicationProtocol</span> {<span class='newline'>
</span>    <span class='xk'>var</span> <span class='xv'>logger</span> = <a class='xt' href='https://swiftinit.org/docs/swift-log/logging/logger' target='_blank' rel='external'>Logger</a>(<span class='xv'>label</span>: <span class='xs'>"hummingbird-logger"</span>)<span class='newline'>
</span>    <span class='xv'>logger</span>.<a class='xv' href='https://swiftinit.org/docs/swift-log/logging/logger.loglevel' target='_blank' rel='external'>logLevel</a> = .<a class='xv' href='https://swiftinit.org/docs/swift-log/logging/logger/level.trace' target='_blank' rel='external'>trace</a><span class='newline'>

</span>    <span class='xk'>let</span> <span class='xv'>env</span> = <span class='xt'>Environment</span>()<span class='newline'>
</span>    <span class='xc'>// let env = try await Environment.dotEnv()</span><span class='newline'>
</span>    <span class='xk'>let</span> <span class='xv'>logLevel</span> = <span class='xv'>env</span>.<span class='xv'>get</span>(<span class='xs'>"LOG_LEVEL"</span>)<span class='newline'>

</span>    <span class='xk'>if</span> <span class='xk'>let</span> <span class='xv'>logLevel</span>, <span class='xk'>let</span> <span class='xv'>logLevel</span> = <a class='xt' href='https://swiftinit.org/docs/swift-log/logging/logger' target='_blank' rel='external'>Logger</a>.<a class='xt' href='https://swiftinit.org/docs/swift-log/logging/logger/level' target='_blank' rel='external'>Level</a>(<span class='xv'>rawValue</span>: <span class='xv'>logLevel</span>) {<span class='newline'>
</span>        <span class='xv'>logger</span>.<a class='xv' href='https://swiftinit.org/docs/swift-log/logging/logger.loglevel' target='_blank' rel='external'>logLevel</a> = <span class='xv'>logLevel</span><span class='newline'>
</span>    }<span class='newline'>

</span>    <span class='xk'>let</span> <span class='xv'>router</span> = <span class='xt'>Router</span>()<span class='newline'>
</span>    <span class='xv'>router</span>.<span class='xv'>get</span>(<span class='xs'>"/"</span>) { _, _ <span class='xk'>in</span><span class='newline'>
</span>        <span class='xk'>return</span> <span class='xs'>"Hello"</span><span class='newline'>
</span>    }<span class='newline'>

</span>    <span class='xk'>let</span> <span class='xv'>app</span> = <span class='xt'>Application</span>(<span class='newline'>
</span>        <span class='xv'>router</span>: <span class='xv'>router</span>,<span class='newline'>
</span>        <span class='xv'>configuration</span>: <span class='xv'>configuration</span>,<span class='newline'>
</span>        <span class='xv'>logger</span>: <span class='xv'>logger</span><span class='newline'>
</span>    )<span class='newline'>
</span>    <span class='xk'>return</span> <span class='xv'>app</span><span class='newline'>
</span>}</code></pre><a rel='ugc' href='https://github.com/swift-on-server/site/blob/main/Snippets/environment.swift#L10' target='_blank' class='source github'><span class='file'>environment.swift</span>:<span class='line'>10</span></a><p>If you run the project from Xcode, make sure you set a custom working directory, otherwise the framework won’t be able to locate your dotenv file.</p><h2 id='What%E2%80%99s%20next?'><a href='#What%E2%80%99s%20next?'>What’s next?</a></h2><p>Environment variables are crucial for modifying application behavior without code changes, offering flexibility across environments. They’re commonly used for feature flags, secrets, and other configuration purposes. In our next article we will discover how to store secrets and API credentials in a secure way.</p></section><div style='display: none;' id='ss:tooltips'><a href='/hist/swift-on-server.site:main/site/logging-for-server-side-swift-apps'><p>Logging is an essential practice that helps you understand what happens within your program.</p></a><a href='/docs/swift/foundation/processinfo'><pre><code><span class='xk'>class</span> <span class='xv'>ProcessInfo</span></code></pre></a><a href='/docs/swift/foundation/processinfo.processinfo'><pre><code><span class='xk'>static</span> <span class='xk'>let</span> <span class='xv'>processInfo</span>: <span class='xt'>ProcessInfo</span></code></pre></a><a href='/docs/swift/foundation/processinfo.environment'><pre><code><span class='xk'>var</span> <span class='xv'>environment</span>: [<span class='xt'>String</span> : <span class='xt'>String</span>] { <span class='xk'>get</span> }</code></pre></a><a href='/docs/swift/swift/dictionary.subscript(_:)?hash=8RFQL'><pre><code><span class='xk'>subscript</span>(<span class='xi'></span><span class='xv'>key</span>: <span class='xt'>Key</span><wbr>) -&gt; <span class='xt'>Value</span>? { <span class='xk'>get</span> <span class='xk'>set</span> }</code></pre><p>Accesses the value associated with the given key for reading and writing.</p></a><a href='/docs/swift/swift.%3F%3F(_:_:)?hash=8BUAU'><pre><code><span class='xk'>func</span> <span class='xo'>??</span> &lt;<span class='xu'>T</span>&gt;(<span class='xi'></span><span class='xv'>optional</span>: <span class='xt'>T</span>?, <span class='xi'></span><span class='xv'>defaultValue</span>: <span class='xa'>@autoclosure</span> () <span class='xk'>throws</span> -&gt; <span class='xt'>T</span><wbr>) <span class='xk'>rethrows</span> -&gt; <span class='xt'>T</span></code></pre><p>Performs a nil-coalescing operation, returning the wrapped value of an <code>Optional</code> instance or a default value.</p></a><a href='/docs/swift/swift.print(_:separator:terminator:)'><pre><code><span class='xk'>func</span> <span class='xv'>print</span>(<span class='xi'></span>_ <span class='xb'>items</span>: <span class='xk'>Any</span>..., <span class='xi'></span><span class='xv'>separator</span>: <span class='xt'>String</span> = <span class='xs'>" "</span>, <span class='xi'></span><span class='xv'>terminator</span>: <span class='xt'>String</span> = <span class='xs'>"\n"</span><wbr>)</code></pre><p>Writes the textual representations of the given items into the standard output.</p></a><a href='/hist/swift-on-server.site:main/site/developing-with-swift-in-visual-studio-code'><p>Swift is a great language for developing applications for Apple platforms, and is easily set up using Xcode. However, Xcode is only available for macOS, and does not support a wide variety of extensions.</p></a><a href='/docs/swift-log/logging/logger'><pre><code><span class='xk'>struct</span> <span class='xv'>Logger</span></code></pre><p>A <code>Logger</code> is the central type in <code>SwiftLog</code>. Its central function is to emit log messages using one of the methods corresponding to a log level.</p></a><a href='/docs/swift-log/logging/logger.loglevel'><pre><code><span class='xk'>var</span> <span class='xv'>logLevel</span>: <span class='xt'>Logger</span>.<span class='xt'>Level</span> { <span class='xk'>get</span> <span class='xk'>set</span> }</code></pre><p>Get or set the log level configured for this <code>Logger</code>.</p></a><a href='/docs/swift-log/logging/logger/level.trace'><pre><code><span class='xk'>case</span> <span class='xv'>trace</span></code></pre><p>Appropriate for messages that contain information normally of use only when tracing the execution of a program.</p></a><a href='/docs/swift-log/logging/logger/level'><pre><code><span class='xk'>enum</span> <span class='xv'>Level</span></code></pre><p>The log level.</p></a></div>