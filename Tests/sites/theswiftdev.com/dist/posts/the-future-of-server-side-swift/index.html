<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>The future of server side Swift - </title>
    <meta name="description" content="What&#39;s going to happen with Swift on the Server in 2022? Distributed actors, Vapor 5, some predictions and wishes.">
    
    <meta property="og:url" content="/posts/the-future-of-server-side-swift/">
    <meta property="og:title" content="The future of server side Swift - ">
    <meta property="og:description" content="What&#39;s going to happen with Swift on the Server in 2022? Distributed actors, Vapor 5, some predictions and wishes.">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="The future of server side Swift - ">
    <meta name="twitter:description" content="What&#39;s going to happen with Swift on the Server in 2022? Distributed actors, Vapor 5, some predictions and wishes.">
    
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon-180x180.png">

</head>

<body>
    <header id="navigation">
        <a id="site-logo" href="">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
        </a>
    
        <nav id="primary-menu">
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/">Home</a>
                <a href="/blog/">Blog</a>
                <a href="/posts/pages/1/">Posts</a>
                <a href="/authors/">Authors</a>
                <a href="/tags/">Tags</a>
                <a href="/my-page/">My page</a>
            </div>
        </nav>
    
        <nav id="secondary-menu">
            <input type="checkbox" id="secondary-menu-button" name="menu-button" class="menu-button">
            <label for="secondary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </label>
            <div class="menu-items right">
                <a href="#">My account</a>
                <a href="/">Logout</a>
            </div>
        </nav>
    </header>
        
    <main>

<article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2022-01-05 16:20:00">2022-01-05 16:20:00</time>
            <h1 class="title">The future of server side Swift</h1>
            <p class="excerpt">What&#39;s going to happen with Swift on the Server in 2022? Distributed actors, Vapor 5, some predictions and wishes.</p>
        </section>
        
    </header>

    <section id="contents" class="content-wrapper">
    
    <h2>The new Swift concurrency model</h2><p>One of the greatest thing about Swift 5.5 is definitely the new <a href="https://docs.swift.org/swift-book/LanguageGuide/Concurrency.html" target="_blank">concurrency model</a>, which introduced quite a lot of new features and APIs. The implementation of the <a href="https://github.com/apple/swift-evolution/blob/main/proposals/0296-async-await.md" target="_blank">async / await</a> proposal allows us completely eliminate the need of unnecessary closures and completion handlers. <a href="https://github.com/apple/swift-evolution/blob/main/proposals/0306-actors.md" target="_blank">Actors</a> are great for isolating data, they can prevent data races and protect you from unwanted memory issues too. With the <a href="https://github.com/apple/swift-evolution/blob/main/proposals/0304-structured-concurrency.md" target="_blank">structured concurrency</a> features were able to define tasks, we can form dependencies between them and they even have built-in cancellation support.</p><p>With these features added we can say that Swift is a great language for writing concurrent code, but whats missing? Well, of course there is always room for improvements and in this case I have some features that Id love to see coming to Swift. </p><p>For example currently there is no way to define an executor object for an actor. This would be a great addition for SwiftNIO and many more server side related projects, because itd heavily reduce the overhead of context switching. An actor with a <a href="https://forums.swift.org/t/support-custom-executors-in-swift-concurrency/44425" target="_blank">custom executor</a> could have an event loop and this way it would be possible to ensure that all the future calls are tied to the exact same event loop.</p><p>The other thing Id like to mention is called <a href="https://www.swift.org/blog/distributed-actors/" target="_blank">distributed actors</a>, this feature is definitely going to come to Swift in the near future. Distributed actors allow developers to scale their programs beyond a single process or node, this means that your code can run on multiple processes or even multiple machines by taking advantage of <a href="https://en.wikipedia.org/wiki/Location_transparency" target="_blank">location transparency</a>. Honestly, I dont know much about distributed actors yet, but I can imagine that this is going to be a game-changer feature. </p><p>I know this is just the beginning of a new era, but still the new concurrency model change quite a lot about how we build our programs. Async / await is extremely powerful and as we move forward and learn more about actors our Swift apps will get even better, through the built-in safety features that they provide. Building reliable apps is a must and I really like this direction that were heading.</p><h2>On the road to Vapor 5</h2><p>Vapor 4 is amazing, but what are the next steps for the web framework? You can find out a little bit more about the future of Vapor by joining the <a href="https://discord.com/invite/vapor" target="_blank">official discord server</a>, there is a vapor-5 channel where people already started to throw in ideas about the next major release.</p><p>Personally, Id like to see some minor changes about Vapor, but Id like to see a major API redesign for Fluent. Currently Fluent Models are working like repositories and they also provide the structural definition for the database schemas. Sorry to say, but I hate this approach. I believe that the schema definition should be completely separated from the queried models. For example:</p><pre><code class="language-swift">import Vapor
import Fluent

struct TodoCreate: Codable {
    let name: String
    let isCompleted: Bool
}

struct TodoList: Codable {
    let id: UUID
    let name: String
    let isCompleted: Bool
}

struct TodoSchema: DatabaseSchema {

    var name: String = "todos"

    var definition = Definition {
        Migration(id: "v1") {
            Process {
                CreateSchema(name) {
                    Field(type: .id)
                    Field(type: .string, .required, key: "name")
                    Field(type: .bool, .required, key: "isComplete")
                    // Unique(on: "title")
                }
            }
            Revert {
                DeleteSchema(name)
            }
        }
        Migration(id: "seed") {
            Process {
                CreateRecords(schema: name) {
                    TodoCreate(name: "foo", isComplete: true)
                }
            }
            Revert {
                DeleteRecords(schema: name)
            }
        }
    }
}

struct TodoRepository: DatabaseRepository {
    typealias Create = TodoCreate
    typealias List = TodoList
}

extension TodoList: Content {}

func someAsyncRequestHandler(_ req: Request) async throws -> [TodoList] {
    let object = TodoCreate(name: "bar", isCompleted: false)
    try await TodoRepository.create(object, on: req.db) 
    return try await TodoRepository.findAll(on: req.db) 
}
</code></pre><p>As you can see instead of mixing up the Model definition with migration related info this way the schema definition could have its own place and the database repository could take care of all the querying and record alteration features. It would be nice to have a DSL-like approach for migrations, since I dont see any benefits of passing around that stupid database pointer. </p><p>Maybe you think, hey youre crazy this idea is stupid, but still my real-world experience is that I need something like this in the future, so yeah, hopefully the core team will see this post and get some inspiration for their future work. Maybe its too late and they dont want to include such drastic changes, but who knows, I can still hope & wish for such things, right?</p><p>My other secret wish is the ability to dynamically reset a Vapor app, because in order to enable and disable a module Id have to remove all the registered routes, middlewares, commands and migrations from the system. Currently this is just partially possible, but I really hope that the core team will provide some kind of open API thatd let me do this.</p><pre><code class="language-swift">import Vapor

public extension Application {
    func reset() {
        app.middleware.storage = []
        app.routes.all = []
        app.migrations.storage = [:]
        app.commands.commands = [:]
    }
}

try app.reset()
</code></pre><p>If this was possible I could load a dylib and provide a proper install, update, delete mechanism through a module manager. This would allow Feather CMS to open a module store and install extensions with just a single click, thatd be HUGE, so please give me this API. </p><p>Anyway, these are just my wishes, Vapor 5 will be a great release Im quite sure about that, one more additional thing is that Id like to see is to reduce the size of the core library (opt-out from websockets, console and multipart libs?, merge async-kit with the core?), itd be nice to completely drop event loop future based APIs and drop the Async* prefixes. Thats all Id like to see.</p><h2>Feather CMS</h2><p>So, after a bit more than one and a half year of development, now Im getting ready to release an actual version of my content management system. Ive had several ups and downs, personal issues during this period of time, but I never stopped thinking about Feather. </p><p>The main idea and purpose is to provide a reliable type-safe modular CMS, written entirely in Swift. The long term goal is to build a dynamic module system, just like the Wordpress plugin ecosystem and Id be able to install and remove components with just a single click, without the need of recompiling the code. This is why Ive researched so much about dylibs and frameworks. This is the reason why Im using hook functions and why Im trying to encapsulate everything inside a module. The good news is that modules will have public API libraries so the server side code can be shared with clients (mostly iOS, but the API code can be easily converted into another languages).</p><h3>What are the problems that Feather tries to solve?</h3><ul><li>There is no easy to use backend (API) system for mobile apps.</li><li>Building admin interfaces on top of a set of APIs is a pain in the ass.</li><li>API definitions are not shared with the client at all (leads to issues)</li><li>Backend developers dont update API docs properly (or they dont write it at all)</li><li>There is no API / CMS with proper user permission & role management</li><li>Swift is resource (low memory footprint) and cost effective on the server</li></ul><p>Hopefully with Feather Ill be able to tackle a few of these issues from the list. Please remember, that this is just my point of view, of course there are many great examples out there and Ive seen properly written systems using node.js, golang or PHP. I dont mind using other technologies, Im a heavy Wordpress user and I like JavaScript too, but I can also see the potential in Swift. </p><p>Id love to see a future where more and more people could use backends written in Swift, maybe even using Feather CMS. I know that changing things will take time and I also know that people dont like changes, but I really hope that theyll realize the importance of Swift.</p><p>We are living in a world where resources are limited and by using a more efficient language we could lower our ecological footprint. With the current chip shortage, we should really thik about this. The M1 CPU and Swift could take over the servers and we could drastically reduce the cost that we have to pay for our backend infrastructures. In 10 years I really wish to look back to this period of time as the beginning of the server side Swift era, but who knows, well see. </p>
        
    </section>
    
    <h2>Next</h2>
    
    <h2>Prev</h2>
        <div class="post card">
            <a href="/posts/hummingbird-routing-and-requests/" target="">
                <figure>
                    <picture>
                        <img
                            src=""
                            alt=""
                            title=""
                        >
                    </picture>
                </figure>
                <section>
                    <time datetime="2023-03-17 16:20:00">2023-03-17 16:20:00</time>
                    <h2 class="title">Hummingbird routing and requests</h2>
                </section>
                <p>Beginner&#39;s guide to learn all about routing and request handling using the Hummingbird server-side Swift framework.</p>
            </a>
        
            
            
        
        </div>
    
    <h2>Related</h2>
    Empty.
    
    <h2>More by author(s)</h2>
    Empty.

</article>

    </main>

    <footer id="page-footer">
        <section class="content-wrapper">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
    
            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p>
                <a href="https://binarybirds.com/">Home</a> 路
                <a href="mailto:binarybirdsofficial@gmail.com">Email</a> 路
                <a href="https://github.com/binarybirds/">GitHub</a> 路
                <a href="https://x.com/tiborbodecs">Twitter</a> 路
                <a href="/rss.xml" target="_blank">RSS</a> 路
                <a href="/sitemap.xml" target="_blank">Sitemap</a>
            </p>
    
            <p class="small"> &copy; 2022 - 2024.</p>
        </section>
    </footer>
</body>
</html>
