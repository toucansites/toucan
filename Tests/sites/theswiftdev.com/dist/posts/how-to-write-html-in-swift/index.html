<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>How to write HTML in Swift? - </title>
    <meta name="description" content="This tutorial is all about rendering HTML docs using a brand new DSL library called SwiftHtml and the Vapor web framework.">
    
    <meta property="og:url" content="/posts/how-to-write-html-in-swift/">
    <meta property="og:title" content="How to write HTML in Swift? - ">
    <meta property="og:description" content="This tutorial is all about rendering HTML docs using a brand new DSL library called SwiftHtml and the Vapor web framework.">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="How to write HTML in Swift? - ">
    <meta name="twitter:description" content="This tutorial is all about rendering HTML docs using a brand new DSL library called SwiftHtml and the Vapor web framework.">
    
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon-180x180.png">

</head>

<body>
    <header id="navigation">
        <a id="site-logo" href="">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
        </a>
    
        <nav id="primary-menu">
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/">Home</a>
                <a href="/blog/">Blog</a>
                <a href="/posts/pages/1/">Posts</a>
                <a href="/authors/">Authors</a>
                <a href="/tags/">Tags</a>
                <a href="/about/">About</a>
            </div>
        </nav>
    
        <nav id="secondary-menu">
            <input type="checkbox" id="secondary-menu-button" name="menu-button" class="menu-button">
            <label for="secondary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </label>
            <div class="menu-items right">
                <a href="#">My account</a>
                <a href="/">Logout</a>
            </div>
        </nav>
    </header>
        
    <main>

<article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2022-01-12 16:20:00">2022-01-12 16:20:00</time>
            <h1 class="title">How to write HTML in Swift?</h1>
            <p class="excerpt">This tutorial is all about rendering HTML docs using a brand new DSL library called SwiftHtml and the Vapor web framework.</p>
        </section>
        
    </header>

    <section id="contents" class="content-wrapper">
    
    <h2>Introducing SwiftHtml</h2><p>This time we‚Äôre going to start everything from scratch. In the first section of this article I‚Äôm going to show you how to setup the <a href="https://github.com/binarybirds/swift-html" target="_blank">SwiftHtml</a> as a package dependency and how to generate HTML output based on a template file. Let‚Äôs start by creating a brand new executable Swift package.</p><pre><code>mkdir Example
cd "$_"
swift package init --type=executable
open Package.swift
</code></pre><p>You can also start with a macOS Command Line Tool from Xcode if you wish, but nowadays I prefer Swift Packages. Anyway, we should add SwiftHtml as a dependency to our package right away.</p><pre><code class="language-swift">// swift-tools-version:5.5
import PackageDescription

let package = Package(
    name: "Example",
    platforms: [
        .macOS(.v12)
    ],
    dependencies: [
        .package(url: "https://github.com/binarybirds/swift-html", from: "1.2.0"),
    ],
    targets: [
        .executableTarget(name: "Example", dependencies: [
            .product(name: "SwiftHtml", package: "swift-html"),
        ]),
        .testTarget(name: "ExampleTests", dependencies: ["Example"]),
    ]
)
</code></pre><p>All right, now we‚Äôre ready to write some Swift DSL code. We‚Äôre going to start with a really basic example to get to know with SwiftHtml. In the main.swift file we should create a new HTML document, then we can use SwiftHtml‚Äôs built-in renderer to print the html source. üñ®</p><pre><code class="language-swift">import SwiftHtml

let doc = Document(.html) {
    Html {
        Head {
            Title("Hello, World!")
            
            Meta().charset("utf-8")
            Meta().name(.viewport).content("width=device-width, initial-scale=1")
        }
        Body {
            Main {
                Div {
                    H1("Hello, World!")
                    P("This page was generated by the SwiftHtml library.")
                }
            }
            .class("container")
        }
    }
}

let html = DocumentRenderer(minify: false, indent: 2).render(doc)
print(html)
</code></pre><p>As you can see the code is pretty straightforward, especially if you know a bit about HTML. The SwiftHtml library tries to follow the naming conventions as closely as possible, so if you‚Äôve written HTML before this syntax should be very familiar, except that you don‚Äôt have to write opening and closing tags, but we can utilize the Swift compiler to do the boring repetative tasks instead of us.</p><p>Since we‚Äôre using a domain specific language in Swift, the compiler can type-check everything at build-time, this way it‚Äôs 100% sure that our HTML code won‚Äôt have syntax issues. Of course you can still make semantic mistakes, but that‚Äôs also possible if you‚Äôre not using a DSL. üòÖ</p><p>The main advantage here is that you won‚Äôt be able to mistype or misspell tags, and you don‚Äôt even have to think about closing tags, but you can use result builders to construct the HTML node tree. SwiftHtml uses tags and it‚Äôll build a tree from them, this way it is possible to efficiently render the entire structure with proper indentation or minification if it is needed.</p><p>The DocumentRenderer object can render a document, it is also possible to create all sorts of SGML-based document types, because the SwiftHtml package comes with an abstraction layer. If you take a look at the package structure you should see that inside the Sources directory there are several other directories, the core of the package is the SwiftSgml component, which allows developers to create other domain specific languages on top of the base components. ü§î<br>For example, if you take a look at the SwiftRss package you will see that it‚Äôs a simple extension over the SwiftSgml library. You can subclass the Tag object to create a new (domain specific) tag with an underlying Node object to represent a custom item for your document.</p><p>The SwiftSgml library is very lightweight. The Node struct is a representation of a given SGML node with a custom type, name and attributes. The Tag class is all about building a hierarchy in between the nodes. The Document struct is a special object which is responsible for rendering the doctype declaration before the root tag if needed, also of course the document contains the root tag, which is the beginning of everything. üòÖ</p><p>SwiftSgml also contains the DocumentRenderer and a simple TagBuilder enum, which is a result builder and it allows us to define our structure in a SwiftUI-like style.</p><p>So the SwiftHtml package is just a set of HTML rules on top of the SwiftSgml library and it follows the W3C HTML reference guides. You can use the output string to save a HTML file, this way you can generate static websites by using the SwiftHtml library.</p><pre><code class="language-swift">import Foundation
import SwiftHtml

let doc = Document(.html) {
    Html {
        Head {
            Title("Hello, World!")
            
            Meta().charset("utf-8")
            Meta().name(.viewport).content("width=device-width, initial-scale=1")
        }
        Body {
            Main {
                Div {
                    H1("Hello, World!")
                    P("This page was generated by the SwiftHtml library.")
                }
            }
            .class("container")
        }
    }
}

do {
    let dir = FileManager.default.homeDirectoryForCurrentUser
    let file = dir.appendingPathComponent("index.html")
    let html = DocumentRenderer(minify: false, indent: 2).render(doc)
    try html.write(to: file, atomically: true, encoding: .utf8)
}
catch {
    fatalError(error.localizedDescription)
}
</code></pre><p>This is just one way to use SwiftHtml, in my opinion static site generators are fine, but the real fun begins when you can render websites based on some kind of dynamic data. üôÉ</p><h2>Using SwiftHtml with Vapor</h2><p>Vapor has an official template engine called <a href="https://docs.vapor.codes/4.0/leaf/overview/" target="_blank">Leaf</a> plus the community also created a type-safe HTML DSL library called <a href="https://github.com/vapor-community/HTMLKit" target="_blank">HTMLKit</a>, so why create something very similar?</p><p>Well, I tried all the available Swift HTML DSL libraries that I was able to find on GitHub, but I was not entirely satisfied with the currently available solutions. Many of them was outdated, incomplete or I simply didn‚Äôt like the flavor of the DSL. I wanted to have a library which is freakin‚Äô lightweight and follows the standards, that‚Äôs the reason why I‚Äôve built SwiftHtml. ü§ê</p><p>How can we integrate SwiftHtml with Vapor? Well, it‚Äôs pretty simple, let‚Äôs add Vapor as a dependency to our project first.</p><pre><code class="language-swift">// swift-tools-version:5.5
import PackageDescription

let package = Package(
    name: "Example",
    platforms: [
        .macOS(.v12)
    ],
    dependencies: [
        .package(url: "https://github.com/binarybirds/swift-html", from: "1.2.0"),
        .package(url: "https://github.com/vapor/vapor", from: "4.54.0"),
    ],
    targets: [
        .executableTarget(name: "Example", dependencies: [
            .product(name: "SwiftHtml", package: "swift-html"),
            .product(name: "Vapor", package: "vapor"),
        ]),
        .testTarget(name: "ExampleTests", dependencies: ["Example"]),
    ]
)
</code></pre><p>We‚Äôre going to need a new protocol, which we can use construct a Tag, this is going to represent a template file, so let‚Äôs call it TemplateRepresentable.</p><pre><code class="language-swift">import Vapor
import SwiftSgml

public protocol TemplateRepresentable {
    
    @TagBuilder
    func render(_ req: Request) -> Tag
}
</code></pre><p>Next, we need something that can render a template file and return with a Response object, that we can use inside a request handler when we setup the route handlers in Vapor. Since we‚Äôre going to return a HTML string, it is necessary to set the proper response headers too.</p><pre><code class="language-swift">import Vapor
import SwiftHtml

public struct TemplateRenderer {
    
    var req: Request
    
    init(_ req: Request) {
        self.req = req
    }

    public func renderHtml(_ template: TemplateRepresentable, minify: Bool = false, indent: Int = 4) -> Response {
        let doc = Document(.html) { template.render(req) }
        let body = DocumentRenderer(minify: minify, indent: indent).render(doc)
        return Response(status: .ok, headers: ["content-type": "text/html"], body: .init(string: body))
    }
}
</code></pre><p>Finally we can extend the built-in Request object to return a new template renderer if we need it.</p><pre><code class="language-swift">import Vapor

public extension Request {
    var templates: TemplateRenderer { .init(self) }
}
</code></pre><p>Now we just have to create a HTML template file. I‚Äôm usually creating a context object right next to the template this way I‚Äôm going to be able to pass around contextual variables for each template file. I‚Äôm quite happy with this approach so far. ‚ò∫Ô∏è</p><pre><code class="language-swift">import Vapor
import SwiftHtml

struct IndexContext {
    let title: String
    let message: String
}

struct IndexTemplate: TemplateRepresentable {
    
    let context: IndexContext
    
    init(_ context: IndexContext) {
        self.context = context
    }
    
    func render(_ req: Request) -> Tag {
        Html {
            Head {
                Title(context.title)
                
                Meta().charset("utf-8")
                Meta().name(.viewport).content("width=device-width, initial-scale=1")
            }
            Body {
                Main {
                    Div {
                        H1(context.title)
                        P(context.message)
                    }
                }
                .class("container")
            }
        }
    }
}
</code></pre><p>Finally we just have to write some boilerplate code to start up our Vapor web server, we can use the app instance and set a get request handler and render our template using the newly created template renderer extension on the Request object.</p><pre><code class="language-swift">import Vapor
import SwiftHtml

var env = try Environment.detect()
try LoggingSystem.bootstrap(from: &env)
let app = Application(env)
defer { app.shutdown() }

app.get { req -> Response in
    let template = IndexTemplate(.init(title: "Hello, World!",
                                    message: "This page was generated by the SwiftHtml library."))
    
    return req.templates.renderHtml(template)
}

try app.run()
</code></pre><p>More or less that‚Äôs it, you should be able to run the server and hopefully you should see the rendered HTML document if you open the <code>http://localhost:8080/</code> address using your browser.</p><p>It is also possible to use one template inside another, since you can call the render method on a template and that template will return a Tag. The beauty of this approach is that you can compose smaller templates together, this way you can come up with a nice project structure with reusable HTML templates written entirely in Swift. I‚Äôm more than happy with this simple solution and seems like, for me, there is no turning back to Leaf or Tau‚Ä¶ ü§ì</p>
        
    </section>
    
    <h2>Next</h2>
    
    <h2>Prev</h2>
        <div class="post card">
            <a href="/posts/hummingbird-routing-and-requests/" target="">
                <figure>
                    <picture>
                        <img
                            src=""
                            alt=""
                            title=""
                        >
                    </picture>
                </figure>
                <section>
                    <time datetime="2023-03-17 16:20:00">2023-03-17 16:20:00</time>
                    <h2 class="title">Hummingbird routing and requests</h2>
                </section>
                <p>Beginner&#39;s guide to learn all about routing and request handling using the Hummingbird server-side Swift framework.</p>
            </a>
        
            
            
        
        </div>
    
    <h2>Related</h2>
    Empty.
    
    <h2>More by author(s)</h2>
    Empty.

</article>

    </main>

    <footer id="page-footer">
        <section class="content-wrapper">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
    
            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p>
                <a href="https://binarybirds.com/">Home</a> ¬∑
                <a href="mailto:binarybirdsofficial@gmail.com">Email</a> ¬∑
                <a href="https://github.com/binarybirds/">GitHub</a> ¬∑
                <a href="https://x.com/tiborbodecs">Twitter</a> ¬∑
                <a href="/rss.xml" target="_blank">RSS</a> ¬∑
                <a href="/sitemap.xml" target="_blank">Sitemap</a>
            </p>
    
            <p class="small"> &copy; 2022 - 2024.</p>
        </section>
    </footer>
</body>
</html>
