<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Progressive Web Apps on iOS - </title>
    <meta name="description" content="This is a beginner&#39;s guide about creating PWAs for iOS including custom icons, splash screens, safe area and dark mode support.">
    
    <meta property="og:url" content="/posts/progressive-web-apps-on-ios/">
    <meta property="og:title" content="Progressive Web Apps on iOS - ">
    <meta property="og:description" content="This is a beginner&#39;s guide about creating PWAs for iOS including custom icons, splash screens, safe area and dark mode support.">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Progressive Web Apps on iOS - ">
    <meta name="twitter:description" content="This is a beginner&#39;s guide about creating PWAs for iOS including custom icons, splash screens, safe area and dark mode support.">
    
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon-180x180.png">

</head>

<body>
    <header id="navigation">
        <a id="site-logo" href="">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
        </a>
    
        <nav id="primary-menu">
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/">Home</a>
                <a href="/blog/">Blog</a>
                <a href="/posts/pages/1/">Posts</a>
                <a href="/authors/">Authors</a>
                <a href="/tags/">Tags</a>
                <a href="/my-page/">My page</a>
            </div>
        </nav>
    
        <nav id="secondary-menu">
            <input type="checkbox" id="secondary-menu-button" name="menu-button" class="menu-button">
            <label for="secondary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </label>
            <div class="menu-items right">
                <a href="#">My account</a>
                <a href="/">Logout</a>
            </div>
        </nav>
    </header>
        
    <main>

<article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2022-01-27 16:20:00">2022-01-27 16:20:00</time>
            <h1 class="title">Progressive Web Apps on iOS</h1>
            <p class="excerpt">This is a beginner&#39;s guide about creating PWAs for iOS including custom icons, splash screens, safe area and dark mode support.</p>
        </section>
        
    </header>

    <section id="contents" class="content-wrapper">
    
    <h2>How to make a PWA for iOS?</h2><p>A <a href="https://en.wikipedia.org/wiki/Progressive_web_application" target="_blank">progressive web application</a> is just a special kind of website, that can look and behave like a native iOS app. In order to build a PWA, first we‚Äôre going to create a regular website using <a href="https://github.com/BinaryBirds/swift-html" target="_blank">SwiftHtml</a>. We can start with a regular executable Swift package with the following dependencies.</p><pre><code class="language-swift">// swift-tools-version:5.5
import PackageDescription

let package = Package(
    name: "Example",
    platforms: [
        .macOS(.v12)
    ],
    dependencies: [
        .package(url: "https://github.com/binarybirds/swift-html", from: "1.2.0"),
        .package(url: "https://github.com/vapor/vapor", from: "4.54.0"),
    ],
    targets: [
        .executableTarget(name: "Example", dependencies: [
            .product(name: "SwiftHtml", package: "swift-html"),
            .product(name: "Vapor", package: "vapor"),
        ]),
        .testTarget(name: "ExampleTests", dependencies: ["Example"]),
    ]
)
</code></pre><p>As you can see we‚Äôre going to use the vapor <a href="https://vapor.codes/" target="_blank">Vapor</a> library to serve our HTML site. If you don‚Äôt know much about Vapor let‚Äôs just say that it is a web application framework, which can be used to build server side Swift applications, it‚Äôs a pretty amazing tool I have a <a href="https://theswiftdev.com/beginners-guide-to-server-side-swift-using-vapor-4/" target="_blank">beginner‚Äôs guide</a> post about it.</p><p>Of course we‚Äôre going to need some components for rendering views using SwiftHtml, you can use the source snippets from <a href="https://theswiftdev.com/how-to-write-html-in-swift/" target="_blank">my previous article</a>, but here it is again how the SwiftHtml-based template engine should look like. You should read my other article if you want to know more about it. ü§ì</p><pre><code class="language-swift">import Vapor
import SwiftSgml

public protocol TemplateRepresentable {
    
    @TagBuilder
    func render(_ req: Request) -> Tag
}

public struct TemplateRenderer {
    
    var req: Request
    
    init(_ req: Request) {
        self.req = req
    }

    public func renderHtml(_ template: TemplateRepresentable, minify: Bool = false, indent: Int = 4) -> Response {
        let doc = Document(.html) { template.render(req) }
        let body = DocumentRenderer(minify: minify, indent: indent).render(doc)
        return Response(status: .ok, headers: ["content-type": "text/html"], body: .init(string: body))
    }
}

public extension Request {
    var templates: TemplateRenderer { .init(self) }
}
</code></pre><p>We‚Äôre also going to need an index template for our main HTML document. Since we‚Äôre using a Swift DSL to write HTML code we don‚Äôt have to worry too much about mistyping a tag, the compiler will protect us and helps to maintain a completely valid HTML structure.</p><pre><code class="language-swift">import Vapor
import SwiftHtml


struct IndexContext {
    let title: String
    let message: String
}

struct IndexTemplate: TemplateRepresentable {
    
    let context: IndexContext
    
    init(_ context: IndexContext) {
        self.context = context
    }
    
    func render(_ req: Request) -> Tag {
        Html {
            Head {
                Title(context.title)
                
                Meta().charset("utf-8")
                Meta().name(.viewport).content("width=device-width, initial-scale=1")
            }
            Body {
                Main {
                    Div {
                        H1(context.title)
                        P(context.message)
                    }
                }
            }
        }
    }
}
</code></pre><p>Finally we can simply render the bootstrap our Vapor server instance, register our route handler and render the index template inside the main entry point of our Swift package by using the previously defined template helper methods on the Request object.</p><pre><code class="language-swift">import Vapor
import SwiftHtml

var env = try Environment.detect()
try LoggingSystem.bootstrap(from: &env)
let app = Application(env)
defer { app.shutdown() }

app.get { req -> Response in
    let template = IndexTemplate(.init(title: "Hello, World!",
                                    message: "This page was generated by the SwiftHtml library."))
    
    return req.templates.renderHtml(template)
}

try app.run()
</code></pre><p>It is just that easy to setup and bootstrap a fully working web server that is capable of rendering a HTML document using the power of Swift and the Vapor framework. If you run the app you should be able to see a working website by visiting the http://localhost:8080/ address.</p><h2>Turning a website into a real iOS PWA</h2><p>Now if we want to transform our website into a standalone PWA, we have to provide a link a special <a href="https://web.dev/add-manifest/" target="_blank">web app manifest</a> file inside the head section of the index template.</p><h3>Meta tags vs manifest.json</h3><p>Seems like Apple follows kind of a strange route if it comes to PWA support. They have quite a history of ‚Äúthinking outside of the box‚Äù, this mindset applies to progressive web apps on iOS, since they don‚Äôt tend to follow the standards at all. For Android devices you could create a <a href="https://web.dev/add-manifest/" target="_blank">manifest.json</a> file with some predefined keys and you‚Äôd be just fine with your PWA. On the other hand Apple nowadays prefers various <a href="https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html" target="_blank">HTML meta tags</a> instead of the web manifest format.</p><p>Personally I don‚Äôt like this approach, because your HTML code will be bloated with all the PWA related stuff (as you‚Äôll see this is going to happen if it comes to launch screen images) and I believe it‚Äôs better to separate these kind of things, but hey it‚Äôs Apple, they can‚Äôt be wrong, right? üòÖ</p><p>Anyways, let me show you how to support various PWA features on iOS.</p><h3>Enabling standalone app mode</h3><p>The very first few keys that we‚Äôd like to add to the index template has the apple-mobile-web-app-capable name and you should use the ‚Äúyes‚Äù string as content. This will indicate that the app should run in full-screen mode, otherwise it‚Äôs going to be displayed using Safari just like a regular site.</p><pre><code class="language-swift">struct IndexTemplate: TemplateRepresentable {
    
    let context: IndexContext
    
    init(_ context: IndexContext) {
        self.context = context
    }
    
    func render(_ req: Request) -> Tag {
        Html {
            Head {
                Title(context.title)
                
                Meta().charset("utf-8")
                Meta().name(.viewport).content("width=device-width, initial-scale=1")

                Meta()
                    .name(.appleMobileWebAppCapable)
                    .content("yes")
            }
            Body {
                Main {
                    Div {
                        H1(context.title)
                        P(context.message)
                    }
                }
            }
        }
    }
}
</code></pre><p>We should change the hostname of the server and listen on the 0.0.0.0 address, this way if your phone is on the same local WiFi network you should be able to reach your web server directly.</p><pre><code class="language-swift">import Vapor
import SwiftHtml

var env = try Environment.detect()
try LoggingSystem.bootstrap(from: &env)
let app = Application(env)
defer { app.shutdown() }

app.http.server.configuration.hostname = "0.0.0.0"
if let hostname = Environment.get("SERVER_HOSTNAME") {
    app.http.server.configuration.hostname = hostname
}

app.get { req -> Response in
    let template = IndexTemplate(.init(title: "Hello, World!",
                                    message: "This page was generated by the SwiftHtml library."))
    
    return req.templates.renderHtml(template)
}

try app.run()
</code></pre><p>You can find out your <a href="https://stackoverflow.com/questions/13322485/how-to-get-the-primary-ip-address-of-the-local-machine-on-linux-and-os-x" target="_blank">local IP address</a> by typing the following command into the Terminal app.</p><pre><code class="language-sh"># using ifconfig & grep
ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1'
# using ifconfig & sed
ifconfig | sed -En 's/127.0.0.1//;s/.*inet (addr:)?(([0-9]*\.){3}[0-9]*).*/\2/p'
</code></pre><p>Just use that IP address and go to the http://[ip-address]:8080/ website using your iOS device, then you should be able to add your website to your home screen as a bookmark. Just tap the Share icon using Safari and select the Add to Home Screen menu item from the list. On the new screen tap the Add button on the top right corner, this will create a new icon on your home screen as a bookmark to your page. Optionally, you can provide a custom name for the bookmark. ‚ò∫Ô∏è</p><p>Since we‚Äôve added the meta tag, if you touch the newly created icon it should open the webpage as a standalone app (without using the browser). Of course the app is still just a website rendered using a web view. The status bar won‚Äôt match the white background and it has no custom icon or splash screen yet, but we‚Äôre going to fix those issues right now. üì±</p><h3>Custom name and icon</h3><p>To provide a custom name we just have to add a new meta tag, fortunately the SwiftHtml library has predefined enums for all the Apple related meta names, so you don‚Äôt have to type that much. The icon situation is a bit more difficult, since we have to add a bunch of size variants.</p><pre><code class="language-swift">struct IndexTemplate: TemplateRepresentable {
    
    let context: IndexContext
    
    init(_ context: IndexContext) {
        self.context = context
    }
    
    func render(_ req: Request) -> Tag {
        Html {
            Head {
                Title(context.title)
                
                Meta().charset("utf-8")
                Meta().name(.viewport).content("width=device-width, initial-scale=1")
                
                Meta()
                    .name(.appleMobileWebAppCapable)
                    .content("yes")
                
                Meta()
                    .name(.appleMobileWebAppTitle)
                    .content("Hello PWA")
                
                Link(rel: .appleTouchIcon)
                    .href("/img/apple/icons/192.png")

                for size in [57, 72, 76, 114, 120, 144, 152, 180] {
                    Link(rel: .appleTouchIcon)
                        .sizes("\(size)x\(size)")
                        .href("/img/apple/icons/\(size).png")
                }
            }
            Body {
                Main {
                    Div {
                        H1(context.title)
                        P(context.message)
                    }
                }
            }
        }
    }
}
</code></pre><p>As you can see icons are referenced by using the Link tag, using the Apple touch icon rel attribute. The default icon without the sizes attribute can be a 192x192 pixel image, plus I‚Äôm providing some smaller sizes by using a for loop here. We also need to serve these icon files by using Vapor, that‚Äôs why we‚Äôre going to alter the configuration file and enable the FileFiddleware.</p><pre><code class="language-swift">import Vapor
import SwiftHtml

var env = try Environment.detect()
try LoggingSystem.bootstrap(from: &env)
let app = Application(env)
defer { app.shutdown() }

app.middleware.use(FileMiddleware(publicDirectory: app.directory.publicDirectory))

app.http.server.configuration.hostname = "0.0.0.0"
if let hostname = Environment.get("SERVER_HOSTNAME") {
    app.http.server.configuration.hostname = hostname
}

app.get { req -> Response in
    let template = IndexTemplate(.init(title: "Hello, World!",
                                    message: "This page was generated by the SwiftHtml library."))
    
    return req.templates.renderHtml(template)
}

try app.run()
</code></pre><p>By adding the FileMiddleware to the app with the public directory path configuration your server app is able to serve static files from the Public directory. Feel free to create it and place the app icons under the Public/img/apple/icons folder. If you are running the server from the command line you‚Äôll be fine, but if you are using Xcode you have to specify a <a href="https://theswiftdev.com/custom-working-directory-in-xcode/" target="_blank">custom working directory for Vapor</a>, this will allow the system to look up the public files from the right place.</p><blockquote><p>NOTE: Your custom icons <a href="https://developer.apple.com/forums/thread/92304" target="_blank">won‚Äôt show up</a> if you are using a self-signed certificate.</p></blockquote><p>Build and run the server and try to bookmark your page again using your phone. When you see the add bookmark page you should be able to validate that the app now uses the predefined Hello PWA name and the image preview should show the custom icon file instead of a screenshot of the page.</p><h3>Proper status bar color for iOS PWAs</h3><p>Long story short, there is a great article on <a href="https://css-tricks.com/meta-theme-color-and-trickery/" target="_blank">CSS-Tricks</a> about the most recent version of Safari and how it handles various theme colors on different platforms. It‚Äôs a great article, you should definitely read it, but in most of the cases you won‚Äôt need this much info, but you simply want to support light and dark mode for your progressive web app. That‚Äôs what I‚Äôm going to show you here.</p><p>For light mode we‚Äôre going to use a white background color and for dark mode we use black. We‚Äôre also going to link a new style.css file so we can change the background of the site and the font color according to the current color scheme. First, the new meta tags to support theme colors both for light and dark mode.</p><pre><code class="language-swift">struct IndexTemplate: TemplateRepresentable {
    
    let context: IndexContext
    
    init(_ context: IndexContext) {
        self.context = context
    }
    
    func render(_ req: Request) -> Tag {
        Html {
            Head {
                Title(context.title)
                
                Meta().charset("utf-8")
                Meta().name(.viewport).content("width=device-width, initial-scale=1")
                
                Meta()
                    .name(.appleMobileWebAppCapable)
                    .content("yes")
                Meta()
                    .name(.appleMobileWebAppTitle)
                    .content("Hello PWA")
                
                Meta()
                    .name(.colorScheme)
                    .content("light dark")
                Meta()
                    .name(.themeColor)
                    .content("#fff")
                    .media(.prefersColorScheme(.light))
                Meta()
                    .name(.themeColor)
                    .content("#000")
                    .media(.prefersColorScheme(.dark))
                
                Link(rel: .stylesheet)
                    .href("/css/style.css")
                
                Link(rel: .appleTouchIcon)
                    .href("/img/apple/icons/192.png")
                for size in [57, 72, 76, 114, 120, 144, 152, 180] {
                    Link(rel: .appleTouchIcon)
                        .sizes("\(size)x\(size)")
                        .href("/img/apple/icons/\(size).png")
                }
            }
            Body {
                Main {
                    Div {
                        H1(context.title)
                        P(context.message)
                    }
                }
            }
        }
    }
}
</code></pre><p>Inside the style CSS file we can use a media query to detect the preferred color scheme, just like we did it for the .themeColor meta tag using SwiftHtml.</p><pre><code class="language-css">body {
    background: #fff;
    color: #000;
}
@media (prefers-color-scheme: dark) {
    body {
        background: #000;
        color: #fff;
    }
}
</code></pre><p>That‚Äôs it, now the status bar should use the same color as your main background. Try to switch between dark and light mode and make sure everything works, there is a <a href="https://htmhelldev.netlify.app/theme-color-darkmode.html" target="_blank">cool PWA demo project here</a> with different colors for each mode if you want to double check the code. ‚úÖ</p><h2>Splash screen support</h2><p>Hint: it‚Äôs ridiculous. Splash screens on iOS are problematic. Even native apps tend to cache the wrong splash screen or won‚Äôt render PNG files properly, now if it comes to PWAs this isn‚Äôt necessary better. I was able to provide splash screen images for my app, but it took me quite a while and switching between dark and light mode is totally broken (as far as I know it). üòÖ</p><p>In order to cover every single <a href="https://www.screensizes.app/" target="_blank">device screen size</a>, you have to add lots of linked splash images to your markup. It‚Äôs so ugly I even had to create a bunch of extension methods to my index template.</p><pre><code class="language-swift">extension IndexTemplate {
    
    @TagBuilder
    func splashTags() -> [Tag] {
        splash(320, 568, 2, .landscape)
        splash(320, 568, 2, .portrait)
        splash(414, 896, 3, .landscape)
        splash(414, 896, 2, .landscape)
        splash(375, 812, 3, .portrait)
        splash(414, 896, 2, .portrait)
        splash(375, 812, 3, .landscape)
        splash(414, 736, 3, .portrait)
        splash(414, 736, 3, .landscape)
        splash(375, 667, 2, .landscape)
        splash(375, 667, 2, .portrait)
        splash(1024, 1366, 2, .landscape)
        splash(1024, 1366, 2, .portrait)
        splash(834, 1194, 2, .landscape)
        splash(834, 1194, 2, .portrait)
        splash(834, 1112, 2, .landscape)
        splash(414, 896, 3, .portrait)
        splash(834, 1112, 2, .portrait)
        splash(768, 1024, 2, .portrait)
        splash(768, 1024, 2, .landscape)
    }
    
    @TagBuilder
    func splash(_ width: Int,
                _ height: Int,
                _ ratio: Int,
                _ orientation: MediaQuery.Orientation) -> Tag {
        splashTag(.light, width, height, ratio, orientation)
        splashTag(.dark, width, height, ratio, orientation)
    }
        
    func splashTag(_ mode: MediaQuery.ColorScheme,
                   _ width: Int,
                   _ height: Int,
                   _ ratio: Int,
                   _ orientation: MediaQuery.Orientation) -> Tag {
        Link(rel: .appleTouchStartupImage)
            .media([
                .prefersColorScheme(mode),
                .deviceWidth(px: width),
                .deviceHeight(px: height),
                .webkitDevicePixelRatio(ratio),
                .orientation(orientation),
            ])
            .href("/img/apple/splash/\(calc(width, height, ratio, orientation))\(mode == .light ? "" : "_dark").png")
    }
    
    func calc(_ width: Int,
              _ height: Int,
              _ ratio: Int,
              _ orientation: MediaQuery.Orientation) -> String {
        let w = String(width * ratio)
        let h = String(height * ratio)
        switch orientation {
        case .portrait:
            return w + "x" + h
        case .landscape:
            return h + "x" + w
        }
    }
}
</code></pre><p>Now I can simply add the splashTags() call into the head section, but I‚Äôm not sure if the result is something I can totally agree with. Here, take a look at the end of <a href="https://blog.expo.dev/enabling-ios-splash-screens-for-progressive-web-apps-34f06f096e5c" target="_blank">this tutorial about splash screens</a>, the code required to support iOS splash screens is very long and I haven‚Äôt even told you about the 40 different image files that you‚Äôll need. People are literally using <a href="https://github.com/onderceylan/pwa-asset-generator/issues/51" target="_blank">PWA asset generators</a> to reduce the time needed to generate these kind of pictures, because it‚Äôs quite out of control. üí©</p><h2>Safe area & the notch</h2><p>A special topic I‚Äôd like to talk about is the safe area support and the notch. I can highly recommend to read this article on CSS-Tricks about <a href="https://css-tricks.com/the-notch-and-css/" target="_blank">The Notch and CSS</a> first, but the main trick is that we can use four environmental variables in CSS to set proper margin and padding values.</p><p>First we have to change the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Viewport_meta_tag" target="_blank">viewport meta tag</a> and extend our page beyond the safe area. This can be done by using the viewport-fit cover value. Inside the body of the template we‚Äôre going to add a header and a footer section, those areas will have custom background colors and fill the screen.</p><pre><code class="language-swift">struct IndexTemplate: TemplateRepresentable {
    
    let context: IndexContext
    
    init(_ context: IndexContext) {
        self.context = context
    }
    
    func render(_ req: Request) -> Tag {
        Html {
            Head {
                Title(context.title)
                
                Meta()
                    .charset("utf-8")
                Meta()
                    .name(.viewport)
                    .content("width=device-width, initial-scale=1, viewport-fit=cover")
                    //.content("width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no")
                
                Meta()
                    .name(.appleMobileWebAppCapable)
                    .content("yes")
                Meta()
                    .name(.appleMobileWebAppTitle)
                    .content("Hello PWA")
                
                Meta()
                    .name(.colorScheme)
                    .content("light dark")
                Meta()
                    .name(.themeColor)
                    .content("#fff")
                    .media(.prefersColorScheme(.light))
                Meta()
                    .name(.themeColor)
                    .content("#000")
                    .media(.prefersColorScheme(.dark))
                
                Link(rel: .stylesheet)
                    .href("/css/style.css")
                
                Link(rel: .appleTouchIcon)
                    .href("/img/apple/icons/192.png")
                for size in [57, 72, 76, 114, 120, 144, 152, 180] {
                    Link(rel: .appleTouchIcon)
                        .sizes("\(size)x\(size)")
                        .href("/img/apple/icons/\(size).png")
                }
                
                splashTags()
            }
            Body {
                Header {
                    Div {
                        P("Header area")
                    }
                    .class("safe-area")
                }
                
                Main {
                    Div {
                        Div {
                            H1(context.title)
                            for _ in 0...42 {
                                P(context.message)
                            }
                            A("Refresh page")
                                .href("/")
                        }
                        .class("wrapper")
                    }
                    .class("safe-area")
                }

                Footer {
                    Div {
                        P("Footer area")
                    }
                    .class("safe-area")
                }
            }
        }
    }
}
</code></pre><p>Except the background color we don‚Äôt want other content to flow outside the safe area, so we can define a new CSS class and place some margins on it based on the environment. Also we <a href="https://caniuse.com/?search=calc" target="_blank">can safely use the calc</a> CSS function if we want to add some extra value to the environment.</p><pre><code class="language-css">* {
    margin: 0;
    padding: 0;
}
body {
    background: #fff;
    color: #000;
}
header, footer {
    padding: 1rem;
}
header {
    background: #eee;
}
footer {
    background: #eee;
    padding-bottom: calc(1rem + env(safe-area-inset-bottom));
}
.safe-area {
    margin: 0 env(safe-area-inset-right) 0 env(safe-area-inset-left);
}
.wrapper {
    padding: 1rem;
}
@media (prefers-color-scheme: dark) {
    body {
        background: #000;
        color: #fff;
    }
    header {
        background: #222;
    }
    footer {
        background: #222;
    }
}
</code></pre><p>It looks nice, but what if we‚Äôd like to use custom styles for the PWA version only?</p><h2>Detecting standalone mode</h2><p>If you want to use the display mode media query in your CSS file we have to add a manifest file to our PWA. Yep, that‚Äôs right, I‚Äôve mentioned before that Apple prefers to use meta tags and links, but if you want to use a CSS media query to check if the app runs in a standalone mode you‚Äôll have to create a web manifest.json file with the following contents.</p><pre><code class="language-json">{
  "display": "standalone"
}
</code></pre><p>Next you have to provide a link to the manifest file inside the template file.</p><pre><code class="language-swift">struct IndexTemplate: TemplateRepresentable {
    
    // ...
    
    func render(_ req: Request) -> Tag {
        Html {
            Head {
                // ...
                
                splashTags()
                
                Link(rel: .manifest)
                    .href("/manifest.json")
            }
            Body {
                // ...
            }
        }
    }
}
</code></pre><p>In the CSS file now you can use the display-mode selector to check if the app is running in a standalone mode, you can even combine these selectors and detect standalone mode and dark mode using a single query. <a href="https://www.w3schools.com/css/css_rwd_mediaqueries.asp" target="_blank">Media queries</a> are pretty useful. üòç</p><pre><code class="language-css">/* ... */

@media (display-mode: standalone) {
    header, footer {
        background: #fff;
    }
    header {
        position: sticky;
        top: 0;
        border-bottom: 1px solid #eee;
    }
}
@media (display-mode: standalone) and (prefers-color-scheme: dark) {
    header, footer {
        background: #000;
    }
    header {
        border-bottom: 1px solid #333;
    }
}
</code></pre><p>You can turn the header into a sticky section by using the position: sticky attribute. I usually prefer to follow the iOS style when the website is presented to the end-user as a standalone app and I keep the original theme colors for the web only.</p><p>Don‚Äôt forget to rebuild the backend server, before you test your app. Since we‚Äôve made some meta changes you might have to delete the PWA bookmark and install it again to make things work. ‚ö†Ô∏è</p><p>As you can see building good-looking progressive web apps for iOS is quite tricky, especially if it comes to the <a href="https://gist.github.com/eyecatchup/6dd1236ae6415b1180e9" target="_blank">metadata madness</a> that Apple created. Anyway, I hope this tutorial will help you to build better PWAs for the iOS platform. This is just the tip of the iceberg, we haven‚Äôt talked about JavaScript at all, but maybe I‚Äôll come back with that topic in a new tutorial later on.</p>
        
    </section>
    
    <h2>Next</h2>
    
    <h2>Prev</h2>
        <div class="post card">
            <a href="/posts/hummingbird-routing-and-requests/" target="">
                <figure>
                    <picture>
                        <img
                            src=""
                            alt=""
                            title=""
                        >
                    </picture>
                </figure>
                <section>
                    <time datetime="2023-03-17 16:20:00">2023-03-17 16:20:00</time>
                    <h2 class="title">Hummingbird routing and requests</h2>
                </section>
                <p>Beginner&#39;s guide to learn all about routing and request handling using the Hummingbird server-side Swift framework.</p>
            </a>
        
            
            
        
        </div>
    
    <h2>Related</h2>
    Empty.
    
    <h2>More by author(s)</h2>
    Empty.

</article>

    </main>

    <footer id="page-footer">
        <section class="content-wrapper">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
    
            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p>
                <a href="https://binarybirds.com/">Home</a> ¬∑
                <a href="mailto:binarybirdsofficial@gmail.com">Email</a> ¬∑
                <a href="https://github.com/binarybirds/">GitHub</a> ¬∑
                <a href="https://x.com/tiborbodecs">Twitter</a> ¬∑
                <a href="/rss.xml" target="_blank">RSS</a> ¬∑
                <a href="/sitemap.xml" target="_blank">Sitemap</a>
            </p>
    
            <p class="small"> &copy; 2022 - 2024.</p>
        </section>
    </footer>
</body>
</html>
