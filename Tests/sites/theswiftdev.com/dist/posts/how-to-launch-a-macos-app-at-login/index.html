<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>How to launch a macOS app at login? - </title>
    <meta name="description" content="In this tutorial I&#39;ll show you how to launch a completely sandboxed macOS application on system startup written in Swift.">
    
    <meta property="og:url" content="/posts/how-to-launch-a-macos-app-at-login/">
    <meta property="og:title" content="How to launch a macOS app at login? - ">
    <meta property="og:description" content="In this tutorial I&#39;ll show you how to launch a completely sandboxed macOS application on system startup written in Swift.">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="How to launch a macOS app at login? - ">
    <meta name="twitter:description" content="In this tutorial I&#39;ll show you how to launch a completely sandboxed macOS application on system startup written in Swift.">
    
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon-180x180.png">

</head>

<body>
    <header id="navigation">
        <a id="site-logo" href="">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
        </a>
    
        <nav id="primary-menu">
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/">Home</a>
                <a href="/blog/">Blog</a>
                <a href="/posts/pages/1/">Posts</a>
                <a href="/authors/">Authors</a>
                <a href="/tags/">Tags</a>
                <a href="/my-page/">My page</a>
            </div>
        </nav>
    
        <nav id="secondary-menu">
            <input type="checkbox" id="secondary-menu-button" name="menu-button" class="menu-button">
            <label for="secondary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="1"></circle>
                    <circle cx="12" cy="5" r="1"></circle>
                    <circle cx="12" cy="19" r="1"></circle>
                </svg>
            </label>
            <div class="menu-items right">
                <a href="#">My account</a>
                <a href="/">Logout</a>
            </div>
        </nav>
    </header>
        
    <main>

<article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2017-10-27 16:20:00">2017-10-27 16:20:00</time>
            <h1 class="title">How to launch a macOS app at login?</h1>
            <p class="excerpt">In this tutorial I&#39;ll show you how to launch a completely sandboxed macOS application on system startup written in Swift.</p>
        </section>
        
    </header>

    <section id="contents" class="content-wrapper">
    
    <blockquote><p>WARN: Update: you should simply add the <a href="https://github.com/sindresorhus/LaunchAtLogin" target="_blank">LaunchAtLogin</a> library to your project. Itll take care of everything and it has some other cool utility features.</p></blockquote><h2>Project setup</h2><p>Lets start this tutorial by creating a new Xcode project with a macOS app template. Name it for example MainApplication, use storyboards and of course select Swift as the default language, we dont need tests for this project at all.</p><p>Now that we have the main application target, there is this nice little function available called <code>SMLoginItemSetEnabled</code>. With that function you can register an application bundle identifier to auto start when the user logs in, but you can not register your own app identifier. Sounds crazy, huh? </p><p>You can register a bundle identifier embedded into your main application to get auto-launched by the system. To do this you will have to create a new launcher application which will be launched later by your main application.</p><p>You also have to code sign your application with your Developer ID, otherwise it wont start after you log in to macOS. <a href="http://blog.timschroeder.net/2012/07/03/the-launch-at-login-sandbox-project/" target="_blank">Sandboxing</a> is a crucial part of the process, so make sure that you follow every instruction carefully.</p><h2>Targets & configurations</h2><p>Create a new target inside your current project. Name this new target for example LauncherApplication. Enable sandbox and code signing for both targets (main and launcher apps) under the Signing & Capabilities tab. For the LauncherApplication target in the build settings set skip install to yes.</p><p><img src="skip-install.png" alt="Skip install"></p><p>For the launcher app add a new entry to the Info.plist file: Application is background only with the value: yes. This will set your application as a background app, we dont really need user interface for a launcher tool, right?</p><p><img src="background-only.png" alt="Background only"></p><p>Add a new copy file build phase to your main application target to copy your launcher application into the bundle. The destination should be wrapper and the subpath should be <code>Contents/Library/LoginItems</code>.</p><p><img src="copy-files.png" alt="Copy files"></p><p>Link the <code>ServiceManagement.framework</code> to your main application and double check that the launcher app is embedded into your main application.</p><p><img src="frameworks.png" alt="Frameworks"></p><p>From the <code>LauncherApplication</code>s storyboard file delete your window and your view controller, also you can remove the <code>ViewController.swift</code> file from this target. This is a background app after all, so we dont need these stupid things to lay around.</p><h2>Creating the launcher programmatically</h2><p>Somewhere in your main application you have to register your launcher applications identifier. When your main application starts you have to kill the launcher application if its still running. You can do this by sending a notification to that specific app with the <code>NSDistributedNotificationCenter</code> class.</p><pre><code class="language-swift">import Cocoa
import ServiceManagement

extension Notification.Name {
    static let killLauncher = Notification.Name("killLauncher")
}

@NSApplicationMain
class AppDelegate: NSObject {}


extension AppDelegate: NSApplicationDelegate {

    func applicationDidFinishLaunching(_ aNotification: Notification) {

        let launcherAppId = "com.tiborbodecs.LauncherApplication"
        let runningApps = NSWorkspace.shared.runningApplications
        let isRunning = !runningApps.filter { 
            $0.bundleIdentifier == launcherAppId 
        }.isEmpty

        SMLoginItemSetEnabled(launcherAppId as CFString, true)

        if isRunning {
            DistributedNotificationCenter.default().post(
                name: .killLauncher, 
                object: Bundle.main.bundleIdentifier!
            )
        }
    }
}
</code></pre><p>In the launcher application you have to start your main application if its not running already. Thats it. You should also subscribe for the notifications from the main app to terminate if the launcher is not needed anymore.</p><pre><code class="language-swift">import Cocoa

extension Notification.Name {
    static let killLauncher = Notification.Name("killLauncher")
}

@NSApplicationMain
class AppDelegate: NSObject {

    @objc func terminate() {
        NSApp.terminate(nil)
    }
}

extension AppDelegate: NSApplicationDelegate {

    func applicationDidFinishLaunching(_ aNotification: Notification) {

        let mainAppIdentifier = "com.tiborbodecs.MainApplication"
        let runningApps = NSWorkspace.shared.runningApplications
        let isRunning = !runningApps.filter { 
            $0.bundleIdentifier == mainAppIdentifier 
        }.isEmpty

        if !isRunning {
            DistributedNotificationCenter.default().addObserver(
                self, 
                selector: #selector(self.terminate), 
                name: .killLauncher, 
                object: mainAppIdentifier
            )

            let path = Bundle.main.bundlePath as NSString
            var components = path.pathComponents
            components.removeLast()
            components.removeLast()
            components.removeLast()
            components.append("MacOS")
            components.append("MainApplication") //main app name

            let newPath = NSString.path(withComponents: components)

            NSWorkspace.shared.launchApplication(newPath)
        }
        else {
            self.terminate()
        }
    }
}
</code></pre><p>Thats it, were ready to launch. Export your main application and here is the most important thing: <strong>code sign it with your Developer ID</strong>. Start it, close it, log out and back into the system. Hopefully your main application will be running again.</p>
        
    </section>
    
    <h2>Next</h2>
    
    <h2>Prev</h2>
        <div class="post card">
            <a href="/posts/hummingbird-routing-and-requests/" target="">
                <figure>
                    <picture>
                        <img
                            src=""
                            alt=""
                            title=""
                        >
                    </picture>
                </figure>
                <section>
                    <time datetime="2023-03-17 16:20:00">2023-03-17 16:20:00</time>
                    <h2 class="title">Hummingbird routing and requests</h2>
                </section>
                <p>Beginner&#39;s guide to learn all about routing and request handling using the Hummingbird server-side Swift framework.</p>
            </a>
        
            
            
        
        </div>
    
    <h2>Related</h2>
    Empty.
    
    <h2>More by author(s)</h2>
    Empty.

</article>

    </main>

    <footer id="page-footer">
        <section class="content-wrapper">
            <figure>
                <picture>
                    <source
                        srcset="/images/logos/logo~dark.png"
                        media="(prefers-color-scheme: dark)"
                    >
                    <img
                        id="logo-image"
                        src="/images/logos/logo.png"
                        alt="Logo of "
                        title=""
                    >
                </picture>
            </figure>
    
            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p>
                <a href="https://binarybirds.com/">Home</a> 路
                <a href="mailto:binarybirdsofficial@gmail.com">Email</a> 路
                <a href="https://github.com/binarybirds/">GitHub</a> 路
                <a href="https://x.com/tiborbodecs">Twitter</a> 路
                <a href="/rss.xml" target="_blank">RSS</a> 路
                <a href="/sitemap.xml" target="_blank">Sitemap</a>
            </p>
    
            <p class="small"> &copy; 2022 - 2024.</p>
        </section>
    </footer>
</body>
</html>
